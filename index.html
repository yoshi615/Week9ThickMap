<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>My First MapLibre Map</title>
  <link href="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <select id="basemap-select" style="position:absolute;z-index:1;top:10px;left:10px;">
    <option value="satellite">Googleサテライト</option>
    <option value="positron">Carto Positron</option>
    <option value="darkmatter">Carto Dark Matter</option>
  </select>
  <div id="map"></div>
  <!-- 時系列バー -->
  <div id="timeline-bar">
    <input type="range" id="timeline-range" min="2000" max="2025" value="2010" step="1">
    <span id="timeline-label">2010</span>
    <div id="timeline-ticks">
      <span class="tick" style="left:0%;">2000</span>
      <span class="tick" style="left:25%;">2005</span>
      <span class="tick" style="left:50%;">2012</span>
      <span class="tick" style="left:75%;">2018</span>
      <span class="tick" style="left:100%;">2025</span>
    </div>
  </div>

  <script src="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.js"></script>
  <script>
    // ベースマップスタイル定義
    const styles = {
      satellite: {
        version: 8,
        sources: {
          'google-satellite': {
            type: 'raster',
            tiles: [
              'https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}'
            ],
            tileSize: 256,
            attribution: 'Map data &copy; <a href="https://www.google.com/intl/en_us/help/terms_maps/" target="_blank">Google</a>',
            maxzoom: 21
          }
        },
        layers: [
          {
            id: 'google-satellite-layer',
            type: 'raster',
            source: 'google-satellite'
          }
        ]
      },
      positron: 'https://basemaps.cartocdn.com/gl/positron-gl-style/style.json',
      darkmatter: 'https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json'
    };

    // 初期中心・ズーム
    const center = [-30, 40];
    const zoom = 2.2;

    // マップ初期化
    let map = new maplibregl.Map({
      container: 'map',
      style: styles.satellite,
      center: center,
      zoom: zoom
    });

    // マーカー追加関数
    function addMarkers(mapInstance) {
      // アメリカ
      new maplibregl.Marker({ color: 'blue' })
        .setLngLat([-100, 40])
        .setPopup(new maplibregl.Popup().setText('アメリカ'))
        .addTo(mapInstance);
      // イラン
      new maplibregl.Marker({ color: 'red' })
        .setLngLat([53, 32])
        .setPopup(new maplibregl.Popup().setText('イラン'))
        .addTo(mapInstance);
    }

    addMarkers(map);

    // ベースマップ切替
    document.getElementById('basemap-select').addEventListener('change', function(e) {
      const selected = e.target.value;
      map.setStyle(styles[selected]);
      map.once('styledata', () => addMarkers(map));
    });

    // 時系列バーのイベント
    const timelineRange = document.getElementById('timeline-range');
    const timelineLabel = document.getElementById('timeline-label');
    timelineRange.addEventListener('input', function() {
      timelineLabel.textContent = timelineRange.value;
      // ここで年ごとの地図やデータの切り替え処理を追加できます
    });
  </script>
  <style>
    #map {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
    }
    #timeline-bar {
      position: absolute;
      left: 20px;
      bottom: 20px;
      background: rgba(255,255,255,0.95);
      padding: 14px 20px 30px 20px;
      border-radius: 12px;
      z-index: 2;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 10px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.13);
      border: 1.5px solid #bbb;
    }
    #timeline-range {
      width: 260px;
      accent-color: #1976d2;
      height: 4px;
      margin-bottom: 2px;
    }
    #timeline-label {
      font-weight: bold;
      min-width: 40px;
      text-align: center;
      margin-left: 12px;
      color: #1976d2;
      font-size: 1.1em;
    }
    #timeline-ticks {
      position: relative;
      width: 260px;
      height: 18px;
      margin-top: 4px;
    }
    #timeline-ticks .tick {
      position: absolute;
      top: 0;
      transform: translateX(-50%);
      font-size: 13px;
      color: #333;
      pointer-events: none;
      user-select: none;
      font-family: 'Segoe UI', sans-serif;
      font-weight: 500;
      letter-spacing: 0.5px;
    }
    /* スライダーのつまみを大きく・目立たせる */
    #timeline-range::-webkit-slider-thumb {
      width: 18px;
      height: 18px;
      background: #1976d2;
      border-radius: 50%;
      border: 2px solid #fff;
      box-shadow: 0 2px 6px rgba(0,0,0,0.18);
      cursor: pointer;
      -webkit-appearance: none;
      appearance: none;
    }
    #timeline-range::-moz-range-thumb {
      width: 18px;
      height: 18px;
      background: #1976d2;
      border-radius: 50%;
      border: 2px solid #fff;
      box-shadow: 0 2px 6px rgba(0,0,0,0.18);
      cursor: pointer;
    }
    #timeline-range::-ms-thumb {
      width: 18px;
      height: 18px;
      background: #1976d2;
      border-radius: 50%;
      border: 2px solid #fff;
      box-shadow: 0 2px 6px rgba(0,0,0,0.18);
      cursor: pointer;
    }
    /* スライダーのバー部分 */
    #timeline-range::-webkit-slider-runnable-track {
      height: 6px;
      background: linear-gradient(90deg, #1976d2 0%, #90caf9 100%);
      border-radius: 3px;
    }
    #timeline-range::-ms-fill-lower {
      background: #1976d2;
    }
    #timeline-range::-ms-fill-upper {
      background: #90caf9;
    }
  </style>
</body>
</html>