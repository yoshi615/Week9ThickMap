<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>My First MapLibre Map</title>
  <link href="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <select id="basemap-select" style="position:absolute;z-index:1;top:10px;left:10px;">
    <option value="satellite">Googleサテライト</option>
    <option value="positron">Carto Positron</option>
    <option value="darkmatter">Carto Dark Matter</option>
  </select>
  <div id="map"></div>

  <script src="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.js"></script>
  <script>
    // ベースマップスタイル定義
    const styles = {
      satellite: {
        version: 8,
        sources: {
          'google-satellite': {
            type: 'raster',
            tiles: [
              'https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}'
            ],
            tileSize: 256,
            attribution: 'Map data &copy; <a href="https://www.google.com/intl/en_us/help/terms_maps/" target="_blank">Google</a>',
            maxzoom: 21
          }
        },
        layers: [
          {
            id: 'google-satellite-layer',
            type: 'raster',
            source: 'google-satellite'
          }
        ]
      },
      positron: 'https://basemaps.cartocdn.com/gl/positron-gl-style/style.json',
      darkmatter: 'https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json'
    };

    // 初期中心・ズーム
    const center = [-30, 40];
    const zoom = 2.2;

    // マップ初期化
    let map = new maplibregl.Map({
      container: 'map',
      style: styles.satellite,
      center: center,
      zoom: zoom
    });

    // マーカー追加関数
    function addMarkers(mapInstance) {
      // アメリカ
      new maplibregl.Marker({ color: 'blue' })
        .setLngLat([-100, 40])
        .setPopup(new maplibregl.Popup().setText('アメリカ'))
        .addTo(mapInstance);
      // イラン
      new maplibregl.Marker({ color: 'red' })
        .setLngLat([53, 32])
        .setPopup(new maplibregl.Popup().setText('イラン'))
        .addTo(mapInstance);
    }

    addMarkers(map);

    // ベースマップ切替
    document.getElementById('basemap-select').addEventListener('change', function(e) {
      const selected = e.target.value;
      map.setStyle(styles[selected]);
      map.once('styledata', () => addMarkers(map));
    });
  </script>
</body>
</html>